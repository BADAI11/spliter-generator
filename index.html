<!doctype html>
<html lang="id">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Aplikasi Perhitungan Rasio Splitter (RT/RW NET)</title>
<style>
  body{font-family:system-ui,Arial; padding:18px; background:#f0f2f5; color:#111}
  h1{font-size:22px;margin:8px 0 16px;color:#222;text-align:center}
  .logo{display:flex;justify-content:center;align-items:center;gap:10px;margin-bottom:10px}
  .logo img{height:50px}
  table{border-collapse:collapse;width:100%;max-width:1100px;background:#fff;border-radius:10px;overflow:hidden;box-shadow:0 6px 18px rgba(0,0,0,0.08);margin:auto}
  th,td{padding:10px;border-bottom:1px solid #eee;text-align:center;font-size:14px}
  th{background:#fafafa;font-weight:600}
  tr:nth-child(even){background:#fafafa}
  tr:hover{background:#f1f7ff}
  input[type=number], select, input[type=text]{width:100%;box-sizing:border-box;padding:6px;border:1px solid #ddd;border-radius:6px;font-size:13px}
  .muted{color:#666;font-size:13px}
  .topbar{display:flex;gap:16px;align-items:center;margin-bottom:16px;flex-wrap:wrap;justify-content:center}
  .card{background:#fff;padding:12px;border-radius:8px;box-shadow:0 2px 6px rgba(0,0,0,0.05)}
  .small{font-size:13px}
  footer{margin-top:14px;color:#666;font-size:13px;text-align:center}
  .hasil{font-size:16px;font-weight:bold}
  .hasil.good{color:#0a8f3c;background:#e6ffea;border-radius:6px;padding:4px 6px}
  .hasil.bad{color:#c62828;background:#ffe5e5;border-radius:6px;padding:4px 6px}
  @media (max-width:800px){table{font-size:12px} th,td{padding:6px}}
  @media print{
    body{background:#fff;color:#000}
    .topbar,.card,button,footer{display:none}
    table{box-shadow:none}
    .logo img{height:40px}
  }
</style>
</head>
<body>

<div class="logo">
  <img src="https://cdn-icons-png.flaticon.com/512/483/483947.png" alt="Logo Fiber Optik">
  <h1>Aplikasi Perhitungan Rasio Splitter</h1>
</div>

<div class="topbar">
  <div class="card">
    <label class="small muted">Input Power (dBm)</label>
    <input id="inputPower" type="number" step="0.01" value="9" />
  </div>
  <div class="card">
    <label class="small muted">Nama Jalur</label>
    <input id="namaJalur" type="text" value="" />
  </div>
  <div class="card">
    <label class="small muted">Desa</label>
    <input id="desa" type="text" value="" />
  </div>
  <div class="card">
    <label class="small muted">Kecamatan</label>
    <input id="kec" type="text" value="" />
  </div>
</div>

<table id="tbl">
  <thead>
    <tr>
      <th>No ODP</th>
      <th>Rasio (index)</th>
      <th>Loss Rasio (dB)</th>
      <th>Output Power (dBm)</th>
      <th>Splitter</th>
      <th>Loss Splitter (dB)</th>
      <th>Hasil Redaman (dBm)</th>
    </tr>
  </thead>
  <tbody id="body"></tbody>
</table>

<div style="margin-top:12px;display:flex;gap:10px;flex-wrap:wrap;justify-content:center">
  <button onclick="addRow()" class="card small">Tambah ODP</button>
  <button onclick="removeRow()" class="card small">Hapus ODP terakhir</button>
  <button onclick="resetDefaults()" class="card small">Reset Default</button>
  <button onclick="window.print()" class="card small">Print</button>
</div>

<footer>Versi web dari aplikasi Excel YapsiNet. Loss Splitter pakai konstanta (14 dB untuk 1:16, dll).</footer>

<script>
const lossRasio = {1:20.25,2:17.24,3:15.48,4:14.23,5:13.26,6:12.47,7:11.80,8:11.22,9:10.71,10:10.25,
11:9.84,12:9.46,13:9.11,14:8.79,15:8.49,16:8.21,17:7.95,18:7.70,19:7.47,20:7.26,
21:7.06,22:6.87,23:6.70,24:6.53,25:6.38,26:6.24,27:6.11,28:5.98,29:5.86,30:5.75,
31:5.64,32:5.53,33:5.43,34:5.34,35:5.25,36:5.16,37:5.08,38:5.00,39:4.92,40:4.85,
41:4.78,42:4.71,43:4.64,44:4.58,45:4.52,46:4.46,47:4.40,48:4.34,49:4.29,50:4.24,
51:4.19,52:4.14,53:4.09,54:4.05,55:4.01,56:3.97,57:3.93,58:3.89,59:3.86,60:3.82,
61:3.79,62:3.76,63:3.73,64:3.70};

const splitterLoss = {2:3.0,4:7.0,8:10.0,16:14.0,32:17.0,64:20.0};

const defaults = [
  {no:"ODP 1", rasio:3, splitter:16},
  {no:"ODP 2", rasio:4, splitter:16},
  {no:"ODP 3", rasio:8, splitter:16}
];

function createRow(idx, data){
  const tbody = document.getElementById('body');
  const tr = document.createElement('tr');
  tr.dataset.idx = idx;
  tr.innerHTML = `
    <td><input type="text" class="no" value="${data.no}" /></td>
    <td><input type="number" class="rasio" min="1" max="64" value="${data.rasio}" /></td>
    <td class="lossRasio muted">-</td>
    <td class="outputPower muted">-</td>
    <td>
      <select class="splitter">
        <option>2</option><option>4</option><option>8</option><option>16</option><option>32</option><option>64</option>
      </select>
    </td>
    <td class="lossSplitter muted">-</td>
    <td class="hasil muted">-</td>
  `;
  tbody.appendChild(tr);
  const sel = tr.querySelector('.splitter');
  sel.value = data.splitter;

  tr.querySelector('.rasio').addEventListener('input', computeAll);
  tr.querySelector('.splitter').addEventListener('change', computeAll);
}

function buildTable(){
  const tbody = document.getElementById('body');
  tbody.innerHTML='';
  defaults.forEach((d,i)=> createRow(i,d));
  computeAll();
}

function addRow(){
  const tbody = document.getElementById('body');
  const n = tbody.children.length + 1;
  createRow(n,{no:"ODP "+n, rasio:4, splitter:16});
  computeAll();
}

function removeRow(){
  const tbody = document.getElementById('body');
  if(tbody.children.length>0){ tbody.removeChild(tbody.lastChild); computeAll(); }
}

function resetDefaults(){
  document.getElementById('inputPower').value = 9;
  buildTable();
}

function lookupLossRasio(r){
  r = Number(r);
  if(isNaN(r) || r<1) return 0;
  const idx = Math.max(1, Math.min(64, Math.round(r)));
  return lossRasio[idx] ?? 0;
}

function lookupSplitterLoss(s){
  s = Number(s);
  return splitterLoss[s] ?? 14;
}

function computeAll(){
  const inputPower = Number(document.getElementById('inputPower').value) || 0;
  const tbody = document.getElementById('body');
  
  for(const tr of tbody.children){
    const rasioInput = tr.querySelector('.rasio');
    let rasio = Number(rasioInput.value) || 0;
    
    if(rasio < 1 || rasio > 64){
      rasioInput.style.backgroundColor = "#ffd6d6";
      continue;
    } else {
      rasioInput.style.backgroundColor = "";
    }

    const lossR = lookupLossRasio(rasio);
    tr.querySelector('.lossRasio').textContent = lossR.toFixed(2);

    const outputPower = inputPower - lossR;
    tr.querySelector('.outputPower').textContent = outputPower.toFixed(2);

    const splitterInput = tr.querySelector('.splitter');
    let splitter = Number(splitterInput.value);
    const lossS = lookupSplitterLoss(splitter);
    tr.querySelector('.lossSplitter').textContent = lossS.toFixed(2);

    const hasil = outputPower - lossS;
    const hasilCell = tr.querySelector('.hasil');
    hasilCell.textContent = hasil.toFixed(2);

    if(hasil < -10){
      hasilCell.className = "hasil bad";
    } else {
      hasilCell.className = "hasil good";
    }
  }
}

document.getElementById('inputPower').addEventListener('input', computeAll);

buildTable();
</script>
</body>
</html>
